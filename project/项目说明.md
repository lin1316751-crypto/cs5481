# CS5481 财经数据抓取系统

## � 新用户快速开始

**👉 建议先阅读**: [快速开始.md](./快速开始.md) (5 分钟上手指南)

本文档提供完整的系统说明，包括详细配置、架构设计和常见问题。

---

## 🀽� 快速开始 (3 步)

### 1️⃣ 创建环境

```bash
# 使用 environment.yml (推荐,一键安装所有依赖)
conda env create -f environment.yml
conda activate cs5481
```

### 2️⃣ 配置 API 密钥

**必须配置**: Reddit API (提供 75% 数据)

编辑 `config.yaml` (第 63-65 行):

```yaml
reddit:
  client_id: "你的_client_id"          # 在 https://www.reddit.com/prefs/apps 获取
  client_secret: "你的_client_secret"  # 详见 快速开始.md
  user_agent: "FinancialCrawler/1.0"
```

**可选配置**: NewsAPI (提供 2% 数据)

```yaml
newsapi:
  api_key: "你的_newsapi_key"  # https://newsapi.org/register (可选)
```

### 3️⃣ 启动 Redis

#### 方式 A: Docker Redis (推荐,统一环境)

```powershell
conda activate cs5481
.\start_redis.bat      # 自动启动 Docker Redis 容器
```

#### 方式 B: 本地 Redis (如果不用 Docker)

```powershell
# 1. 安装 Redis for Windows
# 下载: https://github.com/tporadowski/redis/releases
# 或使用 Chocolatey: choco install redis-64

# 2. 启动 Redis 服务
redis-server

# 或注册为 Windows 服务 (推荐):
redis-server --service-install
redis-server --service-start

# 3. 验证 Redis 运行
redis-cli ping
# 应返回: PONG

#4.配置redis（见下文）
```

### 4️⃣ 运行爬虫

```powershell
# 激活环境
conda activate cs5481

# 运行爬虫菜单
.\run.bat
```

---

## 📋 脚本说明

| 脚本                | 功能                                    | 何时使用                      |
| ------------------- | --------------------------------------- | ----------------------------- |
| `start_redis.bat` | **启动 Docker Redis** + 验证配置  | Docker 用户每次开始工作前运行 |
| `run.bat`         | 运行爬虫菜单 (验证/爬取/查看/导出/测试) | 日常操作                      |
| `export_data.bat` | 一键导出 Redis 数据到文件               | 给数据分析团队提供数据        |

**注意**:

- 如果使用**本地 Redis** (非 Docker),不需要运行 `start_redis.bat`
- 直接启动 `redis-server` 后运行 `.\run.bat` 即可
- Docker Redis 和本地 Redis 使用同样的配置 (config.yaml)

---

## 📁 项目结构

```
project/
├── environment.yml         # Conda 环境配置 (推荐使用)
├── requirements.txt        # pip 依赖列表 (备用)
├── config.yaml            # 系统配置文件
├── start_redis.bat        # Redis 启动脚本
├── run.bat                # 爬虫运行菜单
├── control_center.py      # 主程序入口
├── validate_config.py     # 配置验证工具
├── view_redis_data.py     # 数据查看工具
├── crawlers/              # 5个爬虫模块
├── utils/                 # 工具模块
├── tests/                 # 单元测试
└── docs/                  # 详细文档
    ├── 01_快速开始/
    ├── 02_使用指南/
    ├── 03_技术文档/
    └── 04_项目管理/
```

---

## 📚 详细文档

- [快速开始指南](docs/01_快速开始/QUICKSTART.md) - 详细安装步骤
- [Docker Redis 配置](docs/01_快速开始/Docker_Redis配置指南.md) - Redis 详细配置
- [项目文件说明](docs/01_快速开始/项目文件说明.md) - 文件结构说明
- [配置文件说明](docs/02_使用指南/配置文件说明.md) - config.yaml 详解
- [数据字段说明](docs/02_使用指南/数据字段说明.md) - 17个字段详解
- [系统架构说明](docs/03_技术文档/系统架构说明.md) - 技术架构
- [代码审查报告](docs/04_项目管理/代码审查报告_最终版.md) - 代码质量报告

---

## 🔧 常见操作

### 日常使用 (Docker Redis)

```powershell
# 1. 激活环境
conda activate cs5481

# 2. 启动 Docker Redis
.\start_redis.bat

# 3. 运行爬虫
.\run.bat
# 选择菜单: 2. Run crawler once
```

### 日常使用 (本地 Redis)

```powershell
# 1. 激活环境
conda activate cs5481

# 2. 启动本地 Redis (如果未运行)
redis-server
# 或如果已注册为服务: redis-server --service-start

# 3. 运行爬虫
.\run.bat
# 选择菜单: 2. Run crawler once
```

### 查看数据

```powershell
.\run.bat
# 选择菜单: 3. View Redis data
```

### 导出数据 (给数据分析团队)

```powershell
# 方式 1: 使用导出脚本 (推荐)
.\export_data.bat

# 方式 2: 使用菜单
.\run.bat
# 选择菜单: 5. Export data to file
```

### 运行测试

```powershell
.\run.bat
# 选择菜单: 4. Run tests
```

---

## ❓ 常见问题

### Q: 我应该用 Docker Redis 还是本地 Redis?

**推荐 Docker Redis**:

- ✅ 环境统一,配置一致
- ✅ 一键启动 (`.\start_redis.bat`)
- ✅ 数据自动持久化到 `redis_data/`
- ✅ 方便调试 (`docker logs redis-server`)

**使用本地 Redis 的情况**:

- 已经安装了 Redis
- 不想安装 Docker Desktop
- 电脑资源有限

**配置说明**:

- 两种方式使用**相同的 config.yaml**
- 默认配置: `host: localhost, port: 6379`
- 如果本地 Redis 改了端口或设置了密码,需要在 config.yaml 中修改

### Q: 环境不存在?

```bash
conda env create -f environment.yml
conda activate cs5481
```

### Q: Redis 连接失败?

**Docker Redis**:

1. 确认 Docker Desktop 已启动
2. 运行 `.\start_redis.bat`
3. 检查容器状态: `docker ps | findstr redis`

**本地 Redis**:

1. 确认 Redis 服务已启动: `redis-cli ping`
2. 如果返回 `PONG` 说明运行正常
3. 如果没有响应,启动服务: `redis-server`

### Q: 本地 Redis 如何配置密码?

编辑 `config.yaml`:

```yaml
redis:
  host: localhost
  port: 6379
  password: "your_redis_password"  # 填写你的密码
```

Redis 服务端配置:

```bash
# 编辑 redis.conf 或 redis.windows.conf
requirepass your_redis_password
```

### Q: ModuleNotFoundError?

```bash
conda activate cs5481
pip install -r requirements.txt
```

---

## 🎯 核心特性

- **5 大数据源** - Reddit、NewsAPI、RSS、StockTwits、Twitter
- **日处理量 64K+** - Redis 队列存储,自动导出 Parquet
- **17 字段完整数据** - 标题、正文、时间、URL、互动数据等
- **工业级设计** - 模块化、日志轮转、错误重试、去重过滤

---

## 👥 团队协作

小组成员首次使用:

# 1. 克隆项目
git clone <repo-url>
cd project

# 2. 创建环境
conda env create -f environment.yml

# 3. 激活环境
conda activate cs5481

# 4. 配置密钥 (编辑 config.yaml)

# 5. 启动 Redis

（仅限docker，本地redis改config.yaml）
.\start_redis.bat

# 6. 运行爬虫

.\run.bat

---

**环境要求**: Windows + Conda + Docker Desktop
**Python 版本**: 3.9.23
**更新时间**: 2025-10-20
