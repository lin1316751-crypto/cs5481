# ❓ 常见问题解答

## 🔥 最新问题 (2025-10-20)

### ❓ 为什么数据没有保存?
**答**: 导出阈值太高 (50万条),已降低到 1000 条。详见 [问题排查日志.md](问题排查日志.md)

### ❓ 为什么 StockTwits 没有数据?
**答**: 配置键名不匹配,已修复。下次运行应该正常。

### ❓ 为什么 Reddit 失败?
**答**: 
1. 异常处理问题 (已修复)
2. 需要配置 API 密钥 (访问 https://www.reddit.com/prefs/apps)

### ❓ 导出数据报错 'queue_key'?
**答**: 已修复,改为读取 `queue_name` 配置。

---

## 1. 如何停止 run.bat 的循环模式？

### 🛑 停止方法

#### **方法 1: Ctrl+C** (推荐) ⭐
```
运行中看到: [INFO] 等待 3600 秒后再次抓取...

1. 按 Ctrl + C
2. 看到提示: 终止批处理操作吗(Y/N)?
3. 输入 Y
4. 按回车

✅ 循环停止
```

#### **方法 2: 关闭窗口**
- 直接点击窗口右上角的 ❌ 按钮
- 程序会自动终止

#### **方法 3: 任务管理器**
```
1. Ctrl + Shift + Esc (打开任务管理器)
2. 找到 "python.exe" 或 "cmd.exe"
3. 右键 → 结束任务
```

---

## 2. config.yaml 中的循环间隔配置

### 📍 配置位置

打开 `config.yaml`，找到第 **20-25** 行:

```yaml
# ===============================================
# 🔄 爬虫控制配置
# ===============================================
crawler_control:
  loop_interval: 3600  # 循环模式间隔（秒）
                       # 3600 = 1 小时（推荐）
                       # 1800 = 30 分钟
                       # 600 = 10 分钟（测试用）
```

### 🔧 修改频率

#### 改为 30 分钟运行一次:
```yaml
crawler_control:
  loop_interval: 1800  # 1800 秒 = 30 分钟
```

#### 改为 10 分钟运行一次 (测试用):
```yaml
crawler_control:
  loop_interval: 600  # 600 秒 = 10 分钟
```

#### 改为 2 小时运行一次:
```yaml
crawler_control:
  loop_interval: 7200  # 7200 秒 = 2 小时
```

### ⚠️ 注意
- 修改后需要**重新启动**循环模式才会生效
- 建议不要小于 10 分钟，避免过度请求

---

## 3. 命令行参数说明

### **单次运行**
```powershell
python control_center.py
```

### **循环模式（使用 config.yaml 中的间隔）**
```powershell
python control_center.py --loop
```

### **循环模式（自定义间隔）**
```powershell
# 每 30 分钟运行一次
python control_center.py --loop --interval 1800

# 每 10 分钟运行一次
python control_center.py --loop --interval 600
```

---

## 4. 循环模式的输出示例

### **启动时**
```
============================================================
启动循环模式 - 间隔: 3600 秒 (60 分钟)
按 Ctrl+C 停止
============================================================

============================================================
第 1 次运行 - 2025-10-20 15:30:00
============================================================

[INFO] ========== 开始抓取数据 ==========
[INFO] [RSS] 开始抓取...
[INFO] [RSS] 抓取完成 - 文章: 60, 错误: 0
[INFO] [StockTwits] 抓取完成 - 消息: 360, 错误: 0
[INFO] ========== 抓取完成 ==========

============================================================
等待 3600 秒 (60 分钟)
下次运行时间: 2025-10-20 16:30:00
按 Ctrl+C 停止循环
============================================================
```

### **停止时**
```
^C
============================================================
收到停止信号 (Ctrl+C)
总共运行了 3 次
============================================================
[INFO] Loop stopped
```

---

## 5. 运行 run.bat 后的菜单选项

### **新菜单**
```
========================================
Select Operation:
========================================
1. Run configuration check
2. Run crawler once (single run)              ← 单次运行
3. Run crawler in loop mode (continuous)      ← 循环模式
4. View Redis data
5. Export data to files
6. Run tests
7. Exit
========================================
```

### **选择选项 3 后**
```
========================================
[INFO] Starting crawler in LOOP MODE
========================================

This will run the crawler continuously.
Default interval: 1 hour between runs

========================================
HOW TO STOP:
========================================
1. Press Ctrl+C (recommended)
2. Then press 'Y' to confirm termination
3. Or close the window directly
========================================

Press any key to continue . . .
```

---

## 6. 快速测试循环模式

### **步骤 1: 修改为 1 分钟间隔（测试用）**

编辑 `config.yaml`:
```yaml
crawler_control:
  loop_interval: 60  # 60 秒 = 1 分钟
```

### **步骤 2: 运行循环模式**
```powershell
.\run.bat
# 选择: 3
```

### **步骤 3: 观察输出**
- 第 1 次运行完成后
- 等待 60 秒
- 自动开始第 2 次运行

### **步骤 4: 停止循环**
- 按 `Ctrl + C`
- 输入 `Y`
- 按回车

### **步骤 5: 恢复正常间隔**

编辑 `config.yaml`:
```yaml
crawler_control:
  loop_interval: 3600  # 恢复为 1 小时
```

---

## 7. 故障排除

### **问题 1: 按 Ctrl+C 后没反应**
- 等待几秒钟（程序可能正在处理）
- 再次按 `Ctrl + C`
- 或直接关闭窗口

### **问题 2: 循环间隔没生效**
- 确认修改了 `config.yaml`
- 确认保存了文件
- **重新启动**循环模式（停止后再启动）

### **问题 3: 想临时改变间隔**
不需要修改 `config.yaml`，直接使用命令行:
```powershell
# 每 5 分钟运行一次
python control_center.py --loop --interval 300
```

---

## 📋 总结

### **停止循环** ⭐
- 按 `Ctrl + C` → 输入 `Y` → 回车

### **配置间隔** ⭐
- 编辑 `config.yaml` 第 22 行
- `loop_interval: 3600` (改为你想要的秒数)

### **快速测试** ⭐
```powershell
# 1 分钟间隔测试
python control_center.py --loop --interval 60
```

### **推荐间隔** ⭐
- **1 小时** (3600): 平衡性能和实时性
- **30 分钟** (1800): 更实时，但请求更频繁
- **10 分钟** (600): 仅用于测试

---

**更新时间**: 2025-10-20
**相关文件**: 
- `control_center.py` (循环逻辑)
- `config.yaml` (间隔配置)
- `run.bat` (启动菜单)
