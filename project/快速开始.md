# 🚀 快速开始指南

> **目标**: 5 分钟内完成环境搭建和数据爬取

---

## 第 1 步: 创建 Conda 环境 (2 分钟)

```powershell
# 创建环境
conda env create -f environment.yml

# 激活环境
conda activate cs5481
```

✅ **验证**: 看到命令行前缀变为 `(cs5481)`

---

## 第 2 步: 配置 API 密钥 (2 分钟)

### 🔴 必须配置: Reddit API

1. **获取密钥**:

   - 访问 https://www.reddit.com/prefs/apps
   - 点击 **"create another app..."**
   - **App type** 选择 **"script"**
   - **name**: FinancialCrawler (任意)
   - **redirect uri**: http://localhost:8080
   - 点击 **"create app"**
2. **复制密钥**:

   - `client_id`: app 名称下方的字符串 (约 14 位)
   - `client_secret`: "secret" 字段的值 (约 27 位)
3. **编辑 config.yaml** (第 63-65 行):

   ```yaml
   reddit:
     client_id: "你的_client_id"          # ← 改这里
     client_secret: "你的_client_secret"  # ← 改这里
     user_agent: FinanceDataCrawler/1.0
   ```

### :NewsAPI

- 访问 https://newsapi.org/register (免费注册)
- 编辑 `config.yaml` 第 253 行:
  ```yaml
  newsapi:
    api_key: "你的_newsapi_key"  # ← 改这里
  ```
- **注意**: NewsAPI 只提供 2% 数据，可以先跳过

### ✅ 无需配置: RSS

- RSS 数据源提供 15% 数据
- **无需 API 密钥**，开箱即用

---

## 第 3 步: 启动 Redis (30 秒)

### 方式 A: Docker Redis (推荐)

```powershell
.\start_redis.bat
```

### 方式 B: 本地 Redis

```powershell
# 启动 Redis
redis-server

# 或启动 Windows 服务
redis-server --service-start
```

✅ **验证**: 看到 "Redis is ready to accept connections"

---

## 第 4 步: 验证配置 (30 秒)

```powershell
.\run.bat
# 选择: 1. Run configuration check
```

✅ **期望输出**:

```
✓ Reddit 配置有效
✓ RSS 配置有效 (36 个源)
✓ Redis 连接成功
```

❌ **如果失败**:

- Reddit 配置无效 → 检查 `client_id` 和 `client_secret`
- Redis 连接失败 → 运行 `.\start_redis.bat`

---

## 第 5 步: 运行爬虫 (立即开始)

```powershell
.\run.bat
# 选择: 2. Run crawler once (control center)
```

✅ **期望输出**:

```
[Reddit] 成功抓取 250 条数据 (5 个 subreddit × 50 posts)
[RSS] 成功抓取 60 条文章 (36 个源)
总计: 310+ 条数据存入 Redis
```

---

## 🧪 第 6 步: 运行测试 (可选)

```powershell
.\run.bat
# 选择: 5. Run tests
```

✅ **期望输出**:

```
======================== 10 passed, 1 skipped in 2.55s ========================
```

---

## 📊 第 7 步: 查看数据

### 方式 1: 命令行查看

```powershell
.\run.bat
# 选择: 3. View Redis data
```

### 方式 2: 导出数据文件

```powershell
.\run.bat
# 选择: 4. Export data to files
```

导出文件位置: `data_exports/manual_export/`

- `redis_export_YYYYMMDD_HHMMSS.json` (完整 JSON)
- `redis_export_YYYYMMDD_HHMMSS.jsonl` (每行一条，适合 pandas)

---

## 📝 常见问题

### Q1: Redis 连接失败

**症状**: `redis.exceptions.ConnectionError: Error 10061`

**解决**:

```powershell
# Docker 用户
.\start_redis.bat

# 本地 Redis 用户
redis-server --service-start
```

---

### Q2: Reddit API 报错

**症状**: `401 Unauthorized` 或 `praw.exceptions.ResponseException`

**原因**: `client_id` 或 `client_secret` 错误

**解决**:

1. 重新访问 https://www.reddit.com/prefs/apps
2. 确认复制正确（注意空格和引号）
3. 重新编辑 `config.yaml`

---

### Q3: 环境不是 cs5481

**症状**: 运行 `run.bat` 提示 `Please activate cs5481 environment`

**解决**:

```powershell
conda activate cs5481
```

---

### Q4: 测试失败

**症状**: `ModuleNotFoundError: No module named 'redis'`

**原因**: 不在 cs5481 环境

**解决**:

```powershell
conda activate cs5481
.\run.bat  # 选择 5. Run tests
```

---

## 🎯 数据源配置总结

| 数据源               | API 密钥 | 数据占比 | 优先级  | 获取地址                          |
| -------------------- | -------- | -------- | ------- | --------------------------------- |
| **Reddit**     | ✅ 必须  | 75%      | 🔴 高   | https://www.reddit.com/prefs/apps |
| **RSS**        | ❌ 无需  | 15%      | ✅ 开箱 | -                                 |
| **Twitter/X**  | ❌ 无需  | 5%       | 🟡 推荐 | - (使用 snscrape)                 |
| **StockTwits** | ❌ 无需  | 3%       | 🟡 推荐 | - (免费公开 API)                  |
| **NewsAPI**    | ✅ 可选  | 2%       | 🟢 低   | https://newsapi.org/register      |

### 📝 数据源详细说明

#### 1. Reddit (75% 数据) - 必须配置 🔴

- **API 密钥**: ✅ 必须 (见上方第 2 步)
- **监控**: 5 个 subreddit (investing, finance, stocks, wallstreetbets, StockMarket)
- **数据量**: 约 48,000 条/天

#### 2. RSS (15% 数据) - 开箱即用 ✅

- **API 密钥**: ❌ 无需
- **数据源**: 36 个财经新闻网站 (CNBC, WSJ, FT, Bloomberg 等)
- **数据量**: 约 1,440 篇/天

#### 3. Twitter/X (5% 数据) - 推荐启用 🟡

- **API 密钥**: ❌ 无需 (使用 snscrape/twint-fork)
- **监控**: Bloomberg, WSJ, Reuters 等财经媒体账号
- **关键词**: $SPY, $QQQ, stock market, Federal Reserve 等
- **数据量**: 约 5,760 条/天
- **配置**: `config.yaml` 中 `twitter.enabled: true` (默认已启用)

#### 4. StockTwits (3% 数据) - 推荐启用 🟡

- **API 密钥**: ❌ 无需 (免费公开 API)
- **监控**: SPY, QQQ, DIA 等市场指数 ETF
- **特色**: 包含 Bullish/Bearish 情绪标签
- **数据量**: 约 8,640 条/天
- **配置**: `config.yaml` 中 `stocktwits.enabled: true` (默认已启用)

#### 5. NewsAPI (2% 数据) - 可选 🟢

- **API 密钥**: ✅ 可选 (免费账号有额度限制)
- **数据量**: 约 100 条/天
- **建议**: 可以先跳过

### ✅ 推荐配置方案

#### 方案 1: 最小配置 (90% 数据)

```yaml
# 只配置 Reddit API 密钥
reddit:
  client_id: "你的_client_id"
  client_secret: "你的_client_secret"

# RSS 无需配置
rss:
  enabled: true  # 默认已启用

# 禁用其他数据源
twitter:
  enabled: false
stocktwits:
  enabled: false
```

#### 方案 2: 推荐配置 (98% 数据) ⭐

```yaml
# 配置 Reddit API 密钥
reddit:
  client_id: "你的_client_id"
  client_secret: "你的_client_secret"

# 启用所有无需 API 密钥的数据源
rss:
  enabled: true       # 默认已启用
twitter:
  enabled: true       # 默认已启用，使用 snscrape
stocktwits:
  enabled: true       # 默认已启用，免费 API
```

#### 方案 3: 完整配置 (100% 数据)

```yaml
# 在方案 2 基础上，添加 NewsAPI
newsapi:
  api_key: "你的_newsapi_key"
```

**推荐**: 使用 **方案 2**，无需额外配置，获得 98% 数据！

---

## 📂 项目结构

```
project/
├── run.bat                # 主菜单 (验证/爬取/查看/导出/测试)
├── start_redis.bat        # 启动 Docker Redis
├── export_data.bat        # 一键导出数据
├── config.yaml            # 配置文件 (需要手动编辑 API 密钥)
├── environment.yml        # Conda 环境配置
├── control_center.py      # 爬虫控制中心
├── crawlers/              # 爬虫模块
│   ├── reddit_crawler.py  # Reddit 爬虫
│   ├── rss_crawler.py     # RSS 爬虫
│   └── newsapi_crawler.py # NewsAPI 爬虫
├── utils/                 # 工具模块
│   ├── redis_client.py    # Redis 客户端
│   └── data_exporter.py   # 数据导出工具
├── tests/                 # 单元测试
└── docs/                  # 详细文档
```

---

## 🔗 相关文档

- **详细说明**: `项目说明.md`
- **文档结构**: `docs/README.md`
- **技术文档**: `docs/02_技术文档/`

---

## ✅ 检查清单

- [ ] Conda 环境已创建 (`conda env create -f environment.yml`)
- [ ] Conda 环境已激活 (`conda activate cs5481`)
- [ ] Reddit API 密钥已配置 (`config.yaml` 第 63-65 行)
- [ ] Redis 已启动 (`.\start_redis.bat` 或 `redis-server`)
- [ ] 配置验证通过 (`.\run.bat` → 选项 1)
- [ ] 爬虫运行成功 (`.\run.bat` → 选项 2)
- [ ] (可选) 测试全部通过 (`.\run.bat` → 选项 5)

---

🎉 **完成！现在你可以开始采集财经数据了！**
